[{"name":"app.R","content":"# Install required packages if not already installed\nif (!require(shiny)) install.packages(\"shiny\")\nif (!require(ggplot2)) install.packages(\"ggplot2\")\n\n# Laad de shiny bibliotheek\nlibrary(shiny)\nlibrary(ggplot2)\n\n# Definieer de leningberekeningen functie\nlening_berekeningen <- function(P, annual_interest_rate, years, marginaal_belastingtarief, woz_waarde, eigenwoningforfait_percentage, B_vrij_gift) {\n  r <- annual_interest_rate / 12  # Maandelijkse rentevoet\n  n <- years * 12  # Totaal aantal betalingen\n  \n  eigenwoningforfait <- woz_waarde * eigenwoningforfait_percentage\n  \n  A_ann <- (P * r * (1 + r)^n) / ((1 + r)^n - 1)\n  totale_kosten_ann <- A_ann * n\n  maandelijkse_lasten <- round(A_ann, 2)\n  jaarlijkse_kosten <- round(A_ann * 12, 2)\n  \n  jaar <- c()\n  rentebetaling_ann <- c()\n  aflossing_ann <- c()\n  fiscaal_voordeel_ann <- c()\n  fiscaal_voordeel_cum_ann <- c()\n  hoofd_som_ann <- c()\n  spaarpot <- c()\n  netto_voordeel_strategie_1 <- c()\n  \n  current_principal_ann <- P\n  spaarpot_waarde <- 0\n  \n  for (i in 1:n) {\n    interest_payment_ann <- round(current_principal_ann * r, 2)\n    principal_payment_ann <- round(A_ann - interest_payment_ann, 2)\n    current_principal_ann <- current_principal_ann - principal_payment_ann\n    \n    if (i %% 12 == 0) {\n      jaar <- c(jaar, i / 12)\n      \n      rentebetaling_ann <- c(rentebetaling_ann, interest_payment_ann * 12)\n      aflossing_ann <- c(aflossing_ann, principal_payment_ann * 12)\n      fiscaal_voordeel_ann <- c(fiscaal_voordeel_ann, round((interest_payment_ann * 12 - eigenwoningforfait) * marginaal_belastingtarief, 2))\n      cumulatieve_voordeel <- sum(fiscaal_voordeel_ann)\n      fiscaal_voordeel_cum_ann <- c(fiscaal_voordeel_cum_ann, paste(round(cumulatieve_voordeel / 1000, 1), \"k\"))\n      hoofd_som_ann <- c(hoofd_som_ann, round(current_principal_ann / 1000, 1))\n      \n      spaarpot_waarde <- spaarpot_waarde + B_vrij_gift - interest_payment_ann * 12\n      spaarpot_k <- paste(round(spaarpot_waarde / 1000, 1), \"k\")\n      spaarpot <- c(spaarpot, spaarpot_k)\n      \n      rest_lening_k <- round(current_principal_ann / 1000, 1)\n      netto_voordeel <- cumulatieve_voordeel - (rest_lening_k * 1000 - spaarpot_waarde) / 10\n      netto_voordeel_strategie_1 <- c(netto_voordeel_strategie_1, paste(round(netto_voordeel / 1000, 1), \"k\"))\n    }\n  }\n  \n  totaal_fiscaal_voordeel_ann <- sum(fiscaal_voordeel_ann)\n  \n  resultaten_ann <- data.frame(\n    Jaar = jaar,\n    Rentebetaling = rentebetaling_ann,\n    Aflossing = aflossing_ann,\n    Fiscaal_Voordeel = fiscaal_voordeel_ann,\n    Cumulatieve_Voordeel = fiscaal_voordeel_cum_ann,\n    Rest_Lening = paste(hoofd_som_ann, \"k\"),\n    Spaarpot = spaarpot,\n    Netto_voordeel_strategie_1 = netto_voordeel_strategie_1\n  )\n  \n  info <- data.frame(\n    Item = c(\n      \"Lening informatie\",\n      paste(\"Initiele lening:\", format(P, big.mark = \".\", decimal.mark = \",\")),\n      paste(\"Rente:\", annual_interest_rate * 100, \"%\"),\n      \"\",\n      \"Maandelijkse Lasten\",\n      paste(\"Maandelijkse Lasten:\", format(maandelijkse_lasten, big.mark = \".\", decimal.mark = \",\")),\n      \"Jaarlijkse Kosten\",\n      paste(\"Jaarlijkse Kosten:\", format(jaarlijkse_kosten, big.mark = \".\", decimal.mark = \",\")),\n      \"\",\n      \"Annuïteit lening\",\n      paste(\"Totale kosten over de gehele looptijd:\", format(round(totale_kosten_ann, 2), big.mark = \".\", decimal.mark = \",\")),\n      paste(\"Totale fiscale voordeel voor annuïteit lening:\", format(round(totaal_fiscaal_voordeel_ann, 2), big.mark = \".\", decimal.mark = \",\")),\n      \"\",\n      \"Spaarpot informatie\",\n      paste(\"Beginwaarde spaarpot:\", format(B_vrij_gift, big.mark = \".\", decimal.mark = \",\")),\n      paste(\"Totale waarde van de spaarpot aan het einde van de looptijd:\", format(round(spaarpot_waarde, 2), big.mark = \".\", decimal.mark = \",\"))\n    )\n  )\n  \n  list(info = info, resultaten = resultaten_ann)\n}\n\n# UI\nui <- fluidPage(\n  titlePanel(\"Hypotheekrente Aftrek Berekening\"),\n  fluidRow(\n    column(12,\n           p(\"Deze app berekent de financiële voordelen van een annuïteitenhypotheek met hypotheekrenteaftrek en een jaarlijkse spaarpot. Jaarlijks zal de betaalde rente teruggeschonken worden. Het restant dat belastingvrij geschonken kan worden zal tevens geschonken worden en worden gespaard in de spaarpot. De lening kan worden afgelost door deze spaarpot. Het restant zal dan worden geschonken tegen 10% schenkbelasting. Het netto voordeel van deze strategie wordt uitgerekend.\"),\n           br(),\n           p(\"Voer de volgende parameters in om de berekeningen te zien:\"),\n           p(\"1. Hoofdsom: Het initiële bedrag van de lening.\"),\n           p(\"2. Jaarlijkse rentevoet (%): Het jaarlijkse rentepercentage van de lening.\"),\n           p(\"3. Looptijd (jaren): De looptijd van de lening in jaren.\"),\n           p(\"4. Marginaal belastingtarief (%): Het marginale belastingtarief dat van toepassing is op uw inkomen.\"),\n           p(\"5. WOZ-waarde van de woning: De WOZ-waarde van uw woning.\"),\n           p(\"6. Eigenwoningforfait (%): Het eigenwoningforfaitpercentage op basis van de WOZ-waarde. Deze kan de factor op nul gezet worden.\"),\n           p(\"7. Belastingvrijstelling schenking: Het bedrag dat jaarlijks belastingvrij geschonken mag worden.\"),\n           br(),\n           p(\"De app geeft de volgende waarden:\"),\n           p(\"1. Rentebetaling: De totale rente betaald per jaar.\"),\n           p(\"2. Aflossing: Het bedrag dat per jaar op de lening wordt afgelost.\"),\n           p(\"3. Fiscaal Voordeel: Het belastingvoordeel per jaar als gevolg van de hypotheekrenteaftrek.\"),\n           p(\"4. Cumulatieve Voordeel: Het cumulatieve belastingvoordeel tot en met dat jaar.\"),\n           p(\"5. Rest Lening: Het resterende bedrag van de lening aan het einde van elk jaar.\"),\n           p(\"6. Spaarpot: Het opgebouwde bedrag in de spaarpot aan het einde van elk jaar.\"),\n           p(\"7. Netto Voordeel Strategie 1: Het netto voordeel berekend als Cumulatieve Voordeel - (Rest Lening - Spaarpot) / 10.\")\n    )\n  ),\n  sidebarLayout(\n    sidebarPanel(\n      numericInput(\"lening\", \"Hoofdsom:\", 60000),\n      numericInput(\"rente\", \"Jaarlijkse rentevoet (%):\", 7),\n      numericInput(\"looptijd\", \"Looptijd (jaren):\", 30),\n      numericInput(\"belastingtarief\", \"Marginaal belastingtarief (%):\", 36.97),\n      numericInput(\"wozwaarde\", \"WOZ-waarde van de woning:\", 232000),\n      numericInput(\"eigenwoningforfait\", \"Eigenwoningforfait (%):\", 0),\n      numericInput(\"vrij_gift\", \"Belastingvrijstelling schenking:\", 6633),\n      actionButton(\"bereken\", \"Bereken\")\n    ),\n    mainPanel(\n      verbatimTextOutput(\"info\"),\n      tableOutput(\"resultaten\"),\n      plotOutput(\"plot\")\n    )\n  )\n)\n\n# Server\nserver <- function(input, output) {\n  observeEvent(input$bereken, {\n    P <- input$lening\n    annual_interest_rate <- input$rente / 100\n    years <- input$looptijd\n    marginaal_belastingtarief <- input$belastingtarief / 100\n    woz_waarde <- input$wozwaarde\n    eigenwoningforfait_percentage <- input$eigenwoningforfait / 100\n    B_vrij_gift <- input$vrij_gift\n    \n    resultaten <- lening_berekeningen(P, annual_interest_rate, years, marginaal_belastingtarief, woz_waarde, eigenwoningforfait_percentage, B_vrij_gift)\n    \n    output$info <- renderPrint({\n      cat(paste(resultaten$info$Item, collapse = \"\\n\"))\n    })\n    \n    output$resultaten <- renderTable({\n      resultaten$resultaten\n    })\n    \n    output$plot <- renderPlot({\n      ggplot(resultaten$resultaten, aes(x = Jaar)) +\n        geom_line(aes(y = as.numeric(gsub(\"k\", \"\", Cumulatieve_Voordeel)) * 1000, color = \"Cumulatieve Voordeel\")) +\n        geom_line(aes(y = as.numeric(gsub(\"k\", \"\", Spaarpot)) * 1000, color = \"Spaarpot\")) +\n        geom_line(aes(y = as.numeric(gsub(\"k\", \"\", Netto_voordeel_strategie_1)) * 1000, color = \"Netto Voordeel Strategie 1\")) +\n        labs(y = \"Bedrag in Euro's\", color = \"Legend\") +\n        theme_minimal()\n    })\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n","type":"text"}]
